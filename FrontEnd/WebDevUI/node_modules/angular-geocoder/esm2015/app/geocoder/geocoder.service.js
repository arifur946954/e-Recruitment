import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { map } from 'rxjs/operators';
import * as terraformerWktParser from 'terraformer-wkt-parser';
export class GeocoderService {
    constructor(http) {
        this.http = http;
        this.geocoderBaseUrl = 'https://geodata.nationaalgeoregister.nl/locatieserver/v3';
    }
    suggest(query, options) {
        let params = {
            q: query,
            fq: '*',
            start: 0,
            rows: 10,
        };
        if (options) {
            params = Object.assign(params, options);
        }
        return this.http.get(`${this.geocoderBaseUrl}/suggest?`, { params: params })
            .toPromise().then((suggestResultObject) => {
            const collations = this.formatCollations(suggestResultObject.spellcheck.collations);
            const places = this.formatPlaces(suggestResultObject);
            return { collations, places };
        });
    }
    suggest$(query, options) {
        let params = {
            q: query,
            fq: '*',
            start: 0,
        };
        if (options) {
            params = Object.assign(params, options);
        }
        return this.http.get(`${this.geocoderBaseUrl}/suggest?`, { params: params })
            .pipe(map((suggestResultObject) => {
            const collations = this.formatCollations(suggestResultObject.spellcheck.collations);
            const places = this.formatPlaces(suggestResultObject);
            return { collations, places };
        }));
    }
    lookup(id, options) {
        let params = {
            id: id,
            fl: '*'
        };
        if (options) {
            params = Object.assign(params, options);
        }
        return this.http.get(`${this.geocoderBaseUrl}/lookup?`, { params: params }).toPromise().then((lookupResponse) => {
            return this.formatLookupResponse(lookupResponse);
        });
    }
    lookup$(id, options) {
        let params = {
            id: id,
            fl: '*'
        };
        if (options) {
            params = Object.assign(params, options);
        }
        return this.http.get(`${this.geocoderBaseUrl}/lookup?`, { params: params }).pipe(map((lookupResponse) => this.formatLookupResponse(lookupResponse)));
    }
    free(searchTerm, options) {
        let params = {
            q: searchTerm,
            fl: '*',
            fq: '*',
            rows: 10,
            start: 0,
        };
        if (options) {
            params = Object.assign(params, options);
        }
        return this.http.get(`${this.geocoderBaseUrl}/free?`, { params: params })
            .toPromise().then((freeResponse) => {
            return this.formatReverseResponse(freeResponse);
        });
    }
    free$(searchTerm, options) {
        let params = {
            q: searchTerm,
            fl: '*',
            fq: '*',
            rows: 10,
            start: 0,
        };
        if (options) {
            params = Object.assign(params, options);
        }
        return this.http.get(`${this.geocoderBaseUrl}/free?`, { params: params }).pipe(map((freeResponse) => this.formatReverseResponse(freeResponse)));
    }
    reverse(location, options) {
        let params = {
            type: 'adres',
            fq: '*',
            fl: '*',
            rows: 10,
            distance: 200 // meter,
        };
        if (options) {
            params = Object.assign(params, options, location);
        }
        const reverseUrl = 'https://geodata.nationaalgeoregister.nl/locatieserver/revgeo?';
        return this.http.get(reverseUrl, { params: params }).toPromise().then((reverseResponse) => {
            return this.formatReverseResponse(reverseResponse);
        });
    }
    reverse$(location, options) {
        let params = {
            type: 'adres',
            fq: '*',
            fl: '*',
            rows: 10,
            distance: 200 // meter,
        };
        if (options) {
            params = Object.assign(params, options, location);
        }
        const reverseUrl = 'https://geodata.nationaalgeoregister.nl/locatieserver/revgeo?';
        return this.http.get(reverseUrl, { params: params }).pipe(map((reverseResponse) => this.formatReverseResponse(reverseResponse)));
    }
    formatCollations(collations) {
        const parsedCollations = [];
        for (let i = 0; i < collations.length; i += 2) {
            const collation = {
                id: i,
                naam: collations[i + 1].misspellingsAndCorrections[1],
                weergavenaam: `${collations[i + 1].hits} resultaten gevonden voor <strong> ${collations[i + 1].misspellingsAndCorrections[1]} </strong>`,
                hits: collations[i + 1].hits,
            };
            parsedCollations.push(collation);
        }
        return parsedCollations;
    }
    formatPlaces(suggestResponse) {
        const places = suggestResponse.response.docs.map((place) => {
            return Object.assign(Object.assign({}, place), { highlight: suggestResponse.highlighting[place.id].suggest[0] });
        });
        return places;
    }
    /**
     * Parse WKT in lookup response.
     */
    formatLookupResponse(lookupResponse) {
        const formatted = lookupResponse.response.docs.map((lookupResult) => {
            const formattedLookupResult = lookupResult;
            if (lookupResult.centroide_ll) {
                formattedLookupResult.centroide_ll = terraformerWktParser.parse(lookupResult.centroide_ll);
            }
            if (lookupResult.centroide_rd) {
                formattedLookupResult.centroide_rd = terraformerWktParser.parse(lookupResult.centroide_rd);
            }
            if (lookupResult.geometrie_rd) {
                formattedLookupResult.geometrie_rd = terraformerWktParser.parse(lookupResult.geometrie_rd);
            }
            if (lookupResult.geometrie_ll) {
                formattedLookupResult.geometrie_ll = terraformerWktParser.parse(lookupResult.geometrie_ll);
            }
            return formattedLookupResult;
        });
        return formatted[0] || {};
    }
    formatReverseResponse(lookupResultObject) {
        const formatted = lookupResultObject.response.docs.map((reverseResult) => {
            const formattedLookupResult = reverseResult;
            if (reverseResult.centroide_ll) {
                formattedLookupResult.centroide_ll = terraformerWktParser.parse(reverseResult.centroide_ll);
            }
            if (reverseResult.centroide_rd) {
                formattedLookupResult.centroide_rd = terraformerWktParser.parse(reverseResult.centroide_rd);
            }
            if (reverseResult.geometrie_rd) {
                formattedLookupResult.geometrie_rd = terraformerWktParser.parse(reverseResult.geometrie_rd);
            }
            if (reverseResult.geometrie_ll) {
                formattedLookupResult.geometrie_ll = terraformerWktParser.parse(reverseResult.geometrie_ll);
            }
            formattedLookupResult.highlight = reverseResult.weergavenaam;
            return formattedLookupResult;
        });
        return formatted;
    }
}
GeocoderService.decorators = [
    { type: Injectable }
];
GeocoderService.ctorParameters = () => [
    { type: HttpClient }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VvY29kZXIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9hcHAvZ2VvY29kZXIvZ2VvY29kZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFZckMsT0FBTyxLQUFLLG9CQUFvQixNQUFNLHdCQUF3QixDQUFDO0FBRS9ELE1BQU0sT0FBTyxlQUFlO0lBRTFCLFlBQ1UsSUFBZ0I7UUFBaEIsU0FBSSxHQUFKLElBQUksQ0FBWTtRQUZuQixvQkFBZSxHQUFHLDBEQUEwRCxDQUFDO0lBS3BGLENBQUM7SUFFTSxPQUFPLENBQUMsS0FBYSxFQUFFLE9BQXdCO1FBQ3BELElBQUksTUFBTSxHQUFHO1lBQ1gsQ0FBQyxFQUFFLEtBQUs7WUFDUixFQUFFLEVBQUUsR0FBRztZQUNQLEtBQUssRUFBRSxDQUFDO1lBQ1IsSUFBSSxFQUFFLEVBQUU7U0FDVCxDQUFDO1FBRUYsSUFBSSxPQUFPLEVBQUU7WUFDWCxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7U0FDekM7UUFFRCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLGVBQWUsV0FBVyxFQUFFLEVBQUMsTUFBTSxFQUFFLE1BQWEsRUFBQyxDQUFDO2FBQ2hGLFNBQVMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLG1CQUFvQyxFQUFFLEVBQUU7WUFDekQsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLG1CQUFtQixDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUNwRixNQUFNLE1BQU0sR0FBRyxJQUFJ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QzdGO1lBRUQsSUFBSSxhQUFhLENBQUMsWUFBWSxFQUFFO2dCQUM5QixxQkFBcUIsQ0FBQyxZQUFZLEdBQUcsb0JBQW9CLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUMsQ0FBQzthQUM3RjtZQUNELHFCQUFxQixDQUFDLFNBQVMsR0FBRyxhQUFhLENBQUMsWUFBWSxDQUFDO1lBQzdELE9BQU8scUJBQXFCLENBQUM7UUFDL0IsQ0FBQyxDQUFDLENBQUM7UUFFSCxPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDOzs7WUF4T0YsVUFBVTs7O1lBZEYsVUFBVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuaW1wb3J0IHsgU3VnZ2VzdFJlc3BvbnNlLFxyXG4gICAgICAgIFJldmVyc2VPcHRpb25zLFxyXG4gICAgICAgIFJldmVyc2VHZW9tZXRyeSxcclxuICAgICAgICBSZXZlcnNlUmVzcG9uc2UsXHJcbiAgICAgICAgU3VnZ2VzdE9wdGlvbnMsXHJcbiAgICAgICAgTG9va3VwT3B0aW9ucyxcclxuICAgICAgICBMb29rdXBSZXNwb25zZSxcclxuICAgICAgICBTdWdnZXN0T2JqZWN0fSBmcm9tICcuL2xvY2F0aWVzZXJ2ZXIubW9kZWwnO1xyXG5cclxuaW1wb3J0ICogYXMgR2VvSlNPTiBmcm9tICdnZW9qc29uJztcclxuaW1wb3J0ICogYXMgdGVycmFmb3JtZXJXa3RQYXJzZXIgZnJvbSAndGVycmFmb3JtZXItd2t0LXBhcnNlcic7XHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEdlb2NvZGVyU2VydmljZSB7XHJcbiAgcHVibGljIGdlb2NvZGVyQmFzZVVybCA9ICdodHRwczovL2dlb2RhdGEubmF0aW9uYWFsZ2VvcmVnaXN0ZXIubmwvbG9jYXRpZXNlcnZlci92Myc7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsXHJcbiAgKSB7XHJcblxyXG4gIH1cclxuXHJcbiAgcHVibGljIHN1Z2dlc3QocXVlcnk6IHN0cmluZywgb3B0aW9ucz86IFN1Z2dlc3RPcHRpb25zKSB7XHJcbiAgICBsZXQgcGFyYW1zID0ge1xyXG4gICAgICBxOiBxdWVyeSxcclxuICAgICAgZnE6ICcqJywgIC8vIEFsc28gZ2V0IHBlcmNlbGVuXHJcbiAgICAgIHN0YXJ0OiAwLFxyXG4gICAgICByb3dzOiAxMCxcclxuICAgIH07XHJcblxyXG4gICAgaWYgKG9wdGlvbnMpIHtcclxuICAgICAgcGFyYW1zID0gT2JqZWN0LmFzc2lnbihwYXJhbXMsIG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KGAke3RoaXMuZ2VvY29kZXJCYXNlVXJsfS9zdWdnZXN0P2AsIHtwYXJhbXM6IHBhcmFtcyBhcyBhbnl9KVxyXG4gICAgLnRvUHJvbWlzZSgpLnRoZW4oKHN1Z2dlc3RSZXN1bHRPYmplY3Q6IFN1Z2dlc3RSZXNwb25zZSkgPT4ge1xyXG4gICAgICBjb25zdCBjb2xsYXRpb25zID0gdGhpcy5mb3JtYXRDb2xsYXRpb25zKHN1Z2dlc3RSZXN1bHRPYmplY3Quc3BlbGxjaGVjay5jb2xsYXRpb25zKTtcclxuICAgICAgY29uc3QgcGxhY2VzID0gdGhpcy5mb3JtYXRQbGFjZXMoc3VnZ2VzdFJlc3VsdE9iamVjdCk7XHJcbiAgICAgIHJldHVybiB7Y29sbGF0aW9ucywgcGxhY2VzfTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHN1Z2dlc3QkKHF1ZXJ5OiBzdHJpbmcsIG9wdGlvbnM/OiBTdWdnZXN0T3B0aW9ucykge1xyXG4gICAgbGV0IHBhcmFtcyA9IHtcclxuICAgICAgcTogcXVlcnksXHJcbiAgICAgIGZxOiAnKicsICAvLyBBbHNvIGdldCBwZXJjZWxlblxyXG4gICAgICBzdGFydDogMCxcclxuICAgIH07XHJcblxyXG4gICAgaWYgKG9wdGlvbnMpIHtcclxuICAgICAgcGFyYW1zID0gT2JqZWN0LmFzc2lnbihwYXJhbXMsIG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KGAke3RoaXMuZ2VvY29kZXJCYXNlVXJsfS9zdWdnZXN0P2AsIHtwYXJhbXM6IHBhcmFtcyBhcyBhbnl9KVxyXG4gICAgICAucGlwZShcclxuICAgICAgICBtYXAoKHN1Z2dlc3RSZXN1bHRPYmplY3Q6IFN1Z2dlc3RSZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICAgY29uc3QgY29sbGF0aW9ucyA9IHRoaXMuZm9ybWF0Q29sbGF0aW9ucyhzdWdnZXN0UmVzdWx0T2JqZWN0LnNwZWxsY2hlY2suY29sbGF0aW9ucyk7XHJcbiAgICAgICAgICBjb25zdCBwbGFjZXMgPSB0aGlzLmZvcm1hdFBsYWNlcyhzdWdnZXN0UmVzdWx0T2JqZWN0KTtcclxuICAgICAgICAgIHJldHVybiB7Y29sbGF0aW9ucywgcGxhY2VzfTtcclxuICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gIH1cclxuXHJcblxyXG4gIHB1YmxpYyBsb29rdXAoaWQ6IHN0cmluZywgb3B0aW9ucz86IExvb2t1cE9wdGlvbnMpIHtcclxuICAgIGxldCBwYXJhbXMgPSB7XHJcbiAgICAgIGlkOiBpZCxcclxuICAgICAgZmw6ICcqJ1xyXG4gICAgfTtcclxuXHJcbiAgICBpZiAob3B0aW9ucykge1xyXG4gICAgICBwYXJhbXMgPSBPYmplY3QuYXNzaWduKHBhcmFtcywgb3B0aW9ucyk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQoYCR7dGhpcy5nZW9jb2RlckJhc2VVcmx9L2xvb2t1cD9gICwge3BhcmFtczogcGFyYW1zIGFzIGFueX0pLnRvUHJvbWlzZSgpLnRoZW4oKGxvb2t1cFJlc3BvbnNlOiBMb29rdXBSZXNwb25zZSkgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy5mb3JtYXRMb29rdXBSZXNwb25zZShsb29rdXBSZXNwb25zZSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBsb29rdXAkKGlkOiBzdHJpbmcsIG9wdGlvbnM/OiBMb29rdXBPcHRpb25zKSB7XHJcbiAgICBsZXQgcGFyYW1zID0ge1xyXG4gICAgICBpZDogaWQsXHJcbiAgICAgIGZsOiAnKidcclxuICAgIH07XHJcblxyXG4gICAgaWYgKG9wdGlvbnMpIHtcclxuICAgICAgcGFyYW1zID0gT2JqZWN0LmFzc2lnbihwYXJhbXMsIG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KGAke3RoaXMuZ2VvY29kZXJCYXNlVXJsfS9sb29rdXA/YCAsIHtwYXJhbXM6IHBhcmFtcyBhcyBhbnl9KS5waXBlKFxyXG4gICAgICBtYXAoKGxvb2t1cFJlc3BvbnNlOiBMb29rdXBSZXNwb25zZSkgPT4gdGhpcy5mb3JtYXRMb29rdXBSZXNwb25zZShsb29rdXBSZXNwb25zZSkpXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGZyZWUoc2VhcmNoVGVybTogc3RyaW5nLCBvcHRpb25zPzogU3VnZ2VzdE9wdGlvbnMpIHtcclxuICAgIGxldCBwYXJhbXMgPSB7XHJcbiAgICAgIHE6IHNlYXJjaFRlcm0sXHJcbiAgICAgIGZsOiAnKicsXHJcbiAgICAgIGZxOiAnKicsXHJcbiAgICAgIHJvd3M6IDEwLFxyXG4gICAgICBzdGFydDogMCxcclxuICAgIH07XHJcblxyXG4gICAgaWYgKG9wdGlvbnMpIHtcclxuICAgICAgcGFyYW1zID0gT2JqZWN0LmFzc2lnbihwYXJhbXMsIG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KGAke3RoaXMuZ2VvY29kZXJCYXNlVXJsfS9mcmVlP2AsIHtwYXJhbXM6IHBhcmFtcyBhcyBhbnl9KVxyXG4gICAgLnRvUHJvbWlzZSgpLnRoZW4oKGZyZWVSZXNwb25zZTogUmV2ZXJzZVJlc3BvbnNlKSA9PiB7XHJcbiAgICAgIHJldHVybiB0aGlzLmZvcm1hdFJldmVyc2VSZXNwb25zZShmcmVlUmVzcG9uc2UpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZnJlZSQoc2VhcmNoVGVybTogc3RyaW5nLCBvcHRpb25zPzogU3VnZ2VzdE9wdGlvbnMpIHtcclxuICAgIGxldCBwYXJhbXMgPSB7XHJcbiAgICAgIHE6IHNlYXJjaFRlcm0sXHJcbiAgICAgIGZsOiAnKicsXHJcbiAgICAgIGZxOiAnKicsXHJcbiAgICAgIHJvd3M6IDEwLFxyXG4gICAgICBzdGFydDogMCxcclxuICAgIH07XHJcblxyXG4gICAgaWYgKG9wdGlvbnMpIHtcclxuICAgICAgcGFyYW1zID0gT2JqZWN0LmFzc2lnbihwYXJhbXMsIG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KGAke3RoaXMuZ2VvY29kZXJCYXNlVXJsfS9mcmVlP2AsIHtwYXJhbXM6IHBhcmFtcyBhcyBhbnl9KS5waXBlKFxyXG4gICAgICBtYXAoKGZyZWVSZXNwb25zZTogUmV2ZXJzZVJlc3BvbnNlKSA9PiB0aGlzLmZvcm1hdFJldmVyc2VSZXNwb25zZShmcmVlUmVzcG9uc2UpKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyByZXZlcnNlKGxvY2F0aW9uOiBSZXZlcnNlR2VvbWV0cnksIG9wdGlvbnM/OiBSZXZlcnNlT3B0aW9ucykge1xyXG4gICAgbGV0IHBhcmFtcyA9IHtcclxuICAgICAgdHlwZTogICdhZHJlcycsXHJcbiAgICAgIGZxOiAnKicsXHJcbiAgICAgIGZsOiAnKicsXHJcbiAgICAgIHJvd3M6IDEwLFxyXG4gICAgICBkaXN0YW5jZTogMjAwIC8vIG1ldGVyLFxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAob3B0aW9ucykge1xyXG4gICAgICBwYXJhbXMgPSBPYmplY3QuYXNzaWduKHBhcmFtcywgb3B0aW9ucywgbG9jYXRpb24pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHJldmVyc2VVcmwgPSAnaHR0cHM6Ly9nZW9kYXRhLm5hdGlvbmFhbGdlb3JlZ2lzdGVyLm5sL2xvY2F0aWVzZXJ2ZXIvcmV2Z2VvPyc7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldChyZXZlcnNlVXJsLCB7cGFyYW1zOiBwYXJhbXMgYXMgYW55fSkudG9Qcm9taXNlKCkudGhlbigocmV2ZXJzZVJlc3BvbnNlOiBSZXZlcnNlUmVzcG9uc2UpID0+IHtcclxuICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0UmV2ZXJzZVJlc3BvbnNlKHJldmVyc2VSZXNwb25zZSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyByZXZlcnNlJChsb2NhdGlvbjogUmV2ZXJzZUdlb21ldHJ5LCBvcHRpb25zPzogUmV2ZXJzZU9wdGlvbnMpIHtcclxuICAgIGxldCBwYXJhbXMgPSB7XHJcbiAgICAgIHR5cGU6ICAnYWRyZXMnLFxyXG4gICAgICBmcTogJyonLFxyXG4gICAgICBmbDogJyonLFxyXG4gICAgICByb3dzOiAxMCxcclxuICAgICAgZGlzdGFuY2U6IDIwMCAvLyBtZXRlcixcclxuICAgIH07XHJcblxyXG4gICAgaWYgKG9wdGlvbnMpIHtcclxuICAgICAgcGFyYW1zID0gT2JqZWN0LmFzc2lnbihwYXJhbXMsIG9wdGlvbnMsIGxvY2F0aW9uKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCByZXZlcnNlVXJsID0gJ2h0dHBzOi8vZ2VvZGF0YS5uYXRpb25hYWxnZW9yZWdpc3Rlci5ubC9sb2NhdGllc2VydmVyL3Jldmdlbz8nO1xyXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQocmV2ZXJzZVVybCAsIHtwYXJhbXM6IHBhcmFtcyBhcyBhbnl9KS5waXBlKFxyXG4gICAgICBtYXAoKHJldmVyc2VSZXNwb25zZTogUmV2ZXJzZVJlc3BvbnNlKSA9PiB0aGlzLmZvcm1hdFJldmVyc2VSZXNwb25zZShyZXZlcnNlUmVzcG9uc2UpKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZm9ybWF0Q29sbGF0aW9ucyhjb2xsYXRpb25zKSB7XHJcbiAgICBjb25zdCBwYXJzZWRDb2xsYXRpb25zID0gW107XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbGxhdGlvbnMubGVuZ3RoOyBpICs9IDIpIHtcclxuICAgICAgY29uc3QgY29sbGF0aW9uICA9IHtcclxuICAgICAgICBpZDogaSxcclxuICAgICAgICBuYWFtOiBjb2xsYXRpb25zW2kgKyAxXS5taXNzcGVsbGluZ3NBbmRDb3JyZWN0aW9uc1sxXSxcclxuICAgICAgICB3ZWVyZ2F2ZW5hYW06IGAke2NvbGxhdGlvbnNbaSArIDFdLmhpdHN9IHJlc3VsdGF0ZW4gZ2V2b25kZW4gdm9vciA8c3Ryb25nPiAke2NvbGxhdGlvbnNbaSArIDFdLm1pc3NwZWxsaW5nc0FuZENvcnJlY3Rpb25zWzFdfSA8L3N0cm9uZz5gLFxyXG4gICAgICAgIGhpdHM6IGNvbGxhdGlvbnNbaSArIDFdLmhpdHMsXHJcbiAgICAgIH07XHJcbiAgICAgIHBhcnNlZENvbGxhdGlvbnMucHVzaChjb2xsYXRpb24pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHBhcnNlZENvbGxhdGlvbnM7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGZvcm1hdFBsYWNlcyhzdWdnZXN0UmVzcG9uc2U6IFN1Z2dlc3RSZXNwb25zZSkge1xyXG4gICAgY29uc3QgcGxhY2VzID0gc3VnZ2VzdFJlc3BvbnNlLnJlc3BvbnNlLmRvY3MubWFwKChwbGFjZTogU3VnZ2VzdE9iamVjdCkgPT4ge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIC4uLnBsYWNlLFxyXG4gICAgICAgIGhpZ2hsaWdodDogc3VnZ2VzdFJlc3BvbnNlLmhpZ2hsaWdodGluZ1twbGFjZS5pZF0uc3VnZ2VzdFswXVxyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gcGxhY2VzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUGFyc2UgV0tUIGluIGxvb2t1cCByZXNwb25zZS5cclxuICAgKi9cclxuICBwcml2YXRlIGZvcm1hdExvb2t1cFJlc3BvbnNlKGxvb2t1cFJlc3BvbnNlOiBMb29rdXBSZXNwb25zZSkge1xyXG4gICAgY29uc3QgZm9ybWF0dGVkID0gbG9va3VwUmVzcG9uc2UucmVzcG9uc2UuZG9jcy5tYXAoKGxvb2t1cFJlc3VsdCkgPT4ge1xyXG4gICAgICBjb25zdCBmb3JtYXR0ZWRMb29rdXBSZXN1bHQgPSBsb29rdXBSZXN1bHQ7XHJcblxyXG4gICAgICBpZiAobG9va3VwUmVzdWx0LmNlbnRyb2lkZV9sbCkge1xyXG4gICAgICAgIGZvcm1hdHRlZExvb2t1cFJlc3VsdC5jZW50cm9pZGVfbGwgPSB0ZXJyYWZvcm1lcldrdFBhcnNlci5wYXJzZShsb29rdXBSZXN1bHQuY2VudHJvaWRlX2xsKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGxvb2t1cFJlc3VsdC5jZW50cm9pZGVfcmQpIHtcclxuICAgICAgICBmb3JtYXR0ZWRMb29rdXBSZXN1bHQuY2VudHJvaWRlX3JkID0gdGVycmFmb3JtZXJXa3RQYXJzZXIucGFyc2UobG9va3VwUmVzdWx0LmNlbnRyb2lkZV9yZCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChsb29rdXBSZXN1bHQuZ2VvbWV0cmllX3JkKSB7XHJcbiAgICAgICAgZm9ybWF0dGVkTG9va3VwUmVzdWx0Lmdlb21ldHJpZV9yZCA9IHRlcnJhZm9ybWVyV2t0UGFyc2VyLnBhcnNlKGxvb2t1cFJlc3VsdC5nZW9tZXRyaWVfcmQpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAobG9va3VwUmVzdWx0Lmdlb21ldHJpZV9sbCkge1xyXG4gICAgICBmb3JtYXR0ZWRMb29rdXBSZXN1bHQuZ2VvbWV0cmllX2xsID0gdGVycmFmb3JtZXJXa3RQYXJzZXIucGFyc2UobG9va3VwUmVzdWx0Lmdlb21ldHJpZV9sbCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiBmb3JtYXR0ZWRMb29rdXBSZXN1bHQ7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gZm9ybWF0dGVkWzBdIHx8IHt9O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBmb3JtYXRSZXZlcnNlUmVzcG9uc2UobG9va3VwUmVzdWx0T2JqZWN0OiBSZXZlcnNlUmVzcG9uc2UpIHtcclxuICAgIGNvbnN0IGZvcm1hdHRlZCA9IGxvb2t1cFJlc3VsdE9iamVjdC5yZXNwb25zZS5kb2NzLm1hcCgocmV2ZXJzZVJlc3VsdCkgPT4ge1xyXG4gICAgICBjb25zdCBmb3JtYXR0ZWRMb29rdXBSZXN1bHQgPSByZXZlcnNlUmVzdWx0O1xyXG4gICAgICBpZiAocmV2ZXJzZVJlc3VsdC5jZW50cm9pZGVfbGwpIHtcclxuICAgICAgICBmb3JtYXR0ZWRMb29rdXBSZXN1bHQuY2VudHJvaWRlX2xsID0gdGVycmFmb3JtZXJXa3RQYXJzZXIucGFyc2UocmV2ZXJzZVJlc3VsdC5jZW50cm9pZGVfbGwpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAocmV2ZXJzZVJlc3VsdC5jZW50cm9pZGVfcmQpIHtcclxuICAgICAgICBmb3JtYXR0ZWRMb29rdXBSZXN1bHQuY2VudHJvaWRlX3JkID0gdGVycmFmb3JtZXJXa3RQYXJzZXIucGFyc2UocmV2ZXJzZVJlc3VsdC5jZW50cm9pZGVfcmQpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAocmV2ZXJzZVJlc3VsdC5nZW9tZXRyaWVfcmQpIHtcclxuICAgICAgICBmb3JtYXR0ZWRMb29rdXBSZXN1bHQuZ2VvbWV0cmllX3JkID0gdGVycmFmb3JtZXJXa3RQYXJzZXIucGFyc2UocmV2ZXJzZVJlc3VsdC5nZW9tZXRyaWVfcmQpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAocmV2ZXJzZVJlc3VsdC5nZW9tZXRyaWVfbGwpIHtcclxuICAgICAgICBmb3JtYXR0ZWRMb29rdXBSZXN1bHQuZ2VvbWV0cmllX2xsID0gdGVycmFmb3JtZXJXa3RQYXJzZXIucGFyc2UocmV2ZXJzZVJlc3VsdC5nZW9tZXRyaWVfbGwpO1xyXG4gICAgICB9XHJcbiAgICAgIGZvcm1hdHRlZExvb2t1cFJlc3VsdC5oaWdobGlnaHQgPSByZXZlcnNlUmVzdWx0LndlZXJnYXZlbmFhbTtcclxuICAgICAgcmV0dXJuIGZvcm1hdHRlZExvb2t1cFJlc3VsdDtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBmb3JtYXR0ZWQ7XHJcbiAgfVxyXG5cclxuXHJcbn1cclxuIl19